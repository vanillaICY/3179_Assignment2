{
  "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
  "width": "container",
  "height": 400,
  "title": {
    "text": "Purpose of Visitor Arrivals (%)",
    "fontSize": 14,
    "fontWeight": "bold",
    "font": "sans-serif"
  },
  "background": "aliceblue",
  "data": {
    "url": "https://raw.githubusercontent.com/vanillaICY/3179_Assignment2/refs/heads/main/data/arrivals_purpose.csv"
  },
  "params": [
    {
      "name": "yearIndex",
      "value": 3,
      "bind": {
        "input": "range",
        "min": 0,
        "max": 3,
        "step": 1,
        "name": "Year from 2018 (exclude 20-21): "
      }
    }
  ],
  "transform": [
    {
      "calculate": "['2018-19','2022-23','2023-24','2024-25'][yearIndex]",
      "as": "SelectedYear"
    },
    { "filter": "datum.Year === datum.SelectedYear" }
  ],
  "layer": [
    {
      "params": [
        {
          "name": "hoverPurpose",
          "select": {
            "type": "point",
            "fields": ["Purpose"],
            "on": "pointerover",
            "clear": "pointerout"
          }
        }
      ],
      "mark": {
        "type": "arc",
        "innerRadius": 30,
        "stroke": "#fff",
        "strokeWidth": 2
      },
      "encoding": {
        "theta": { "field": "Percent", "type": "quantitative", "stack": true },
        "radius": {
          "field": "Percent",
          "type": "quantitative",
          "scale": {
            "type": "sqrt",
            "zero": true,
            "rangeMin": 30,
            "scheme": "spectral"
          }
        },
        "color": { "field": "Purpose", "type": "nominal" },
        "opacity": {
          "condition": [{ "param": "hoverPurpose", "value": 1 }],
          "value": 0.25
        },
        "tooltip": [
          { "field": "Purpose", "type": "nominal" },
          { "field": "Percent", "type": "quantitative", "format": ".1f" },
          { "field": "Year", "type": "nominal" }
        ]
      }
    },
    {
      "mark": { "type": "text", "radiusOffset": 10 },
      "encoding": {
        "theta": { "field": "Percent", "type": "quantitative", "stack": true },
        "radius": {
          "field": "Percent",
          "type": "quantitative",
          "scale": { "type": "sqrt", "zero": true, "rangeMin": 30 }
        },
        "text": { "field": "Percent", "type": "quantitative", "format": ".1f" },
        "opacity": {
          "condition": [{ "param": "hoverPurpose", "value": 1 }],
          "value": 0.25
        }
      }
    },
    {
      "mark": {
        "type": "text",
        "align": "center",
        "baseline": "middle",
        "fontSize": 18
      },
      "encoding": {
        "text": {
          "expr": "['2018-19 (pre-COVID)','2022-23','2023-24','2024-25'][yearIndex]"
        }
      }
    }
  ],
  "view": { "stroke": null },
  "config": {}
}
