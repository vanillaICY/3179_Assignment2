{
  "$schema": "https://vega.github.io/schema/vega/v6.json",
  "background": "aliceblue",
  "padding": 5,
  "width": 400,
  "height": 300,
  "title": {
    "text": "Purpose of Visitor Arrivals (%)",
    "fontSize": 14,
    "fontWeight": "bold",
    "font": "sans-serif",
    "frame": "group"
  },
  "encode": { "update": { "stroke": { "value": null } } },

  "data": [
    { "name": "hoverPurpose_store" },
    {
      "name": "source_0",
      "url": "https://raw.githubusercontent.com/vanillaICY/3179_Assignment2/refs/heads/main/data/arrivals_purpose.csv",
      "format": { "type": "csv" },
      "transform": [
        {
          "type": "formula",
          "expr": "['2018-19','2022-23','2023-24','2024-25'][yearIndex]",
          "as": "SelectedYear"
        },
        { "type": "filter", "expr": "datum.Year === datum.SelectedYear" }
      ]
    },
    {
      "name": "pieData",
      "source": "source_0",
      "transform": [
        {
          "type": "pie",
          "field": "Percent",
          "sort": true,
          "as": ["startAngle", "endAngle"]
        }
      ]
    }
  ],

  "signals": [
    {
      "name": "yearIndex",
      "value": 3,
      "bind": {
        "input": "range",
        "min": 0,
        "max": 3,
        "step": 1,
        "name": "Year: "
      }
    }
  ],

  "scales": [
    {
      "name": "color",
      "type": "ordinal",
      "domain": { "data": "source_0", "field": "Purpose", "sort": true },
      "range": "category"
    }
  ],

  "marks": [
    {
      "type": "arc",
      "from": { "data": "pieData" },
      "encode": {
        "update": {
          "x": { "signal": "width/2" },
          "y": { "signal": "height/2" },
          "startAngle": { "field": "startAngle" },
          "endAngle": { "field": "endAngle" },
          "innerRadius": { "value": 60 } /* donut */,
          "outerRadius": { "signal": "min(width,height)/2 - 5" } /* fixed */,
          "stroke": { "value": "#fff" },
          "fill": { "scale": "color", "field": "Purpose" },
          "tooltip": {
            "signal": "{\"Purpose\": datum.Purpose, \"Percent\": format(datum.Percent, '.1f'), \"Year\": datum.Year}"
          }
        }
      }
    },
    {
      "type": "text",
      "from": { "data": "pieData" },
      "encode": {
        "update": {
          "x": { "signal": "width/2" },
          "y": { "signal": "height/2" },
          "theta": { "signal": "(datum.startAngle + datum.endAngle)/2" },
          "radius": { "signal": "(min(width,height)/2 + 60)/2" },
          "align": { "value": "center" },
          "baseline": { "value": "middle" },
          "fontSize": { "value": 12 },
          "fill": { "value": "black" },
          "text": { "signal": "format(datum.Percent, '.1f')" }
        }
      }
    },
    {
      "type": "text",
      "encode": {
        "update": {
          "x": { "signal": "width/2" },
          "y": { "signal": "height/2" },
          "align": { "value": "center" },
          "baseline": { "value": "middle" },
          "fontSize": { "value": 16 },
          "fontWeight": { "value": "bold" },
          "fill": { "value": "#333" },
          "text": {
            "signal": "'Year\\n' + ['2018-19','2022-23','2023-24','2024-25'][yearIndex]"
          }
        }
      }
    }
  ],

  "legends": [{ "fill": "color", "title": "Purpose", "symbolType": "circle" }]
}
